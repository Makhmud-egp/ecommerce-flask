{% extends "base.html" %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; margin-top: 2rem;">
    <!-- Product Image -->
    <div>
        {% if product.image_url %}
        <img src="{{ product.image_url }}" alt="{{ product.name }}"
             style="width: 100%; border-radius: 8px;">
        {% else %}
        <div style="width: 100%; height: 400px; background: #eee; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
            üì¶
        </div>
        {% endif %}
    </div>

    <!-- Product Info -->
    <div>
        <h1>{{ product.name }}</h1>
        <p style="color: #666; margin: 1rem 0;">{{ product.description }}</p>

        <div class="price" style="font-size: 2rem; margin: 1.5rem 0;">
            ${{ "%.2f"|format(product.price) }}
        </div>

        <p style="color: #999; margin-bottom: 2rem;">
            Stock: {{ product.stock_quantity }} available
        </p>

        {% if product.stock_quantity > 0 %}
        <form id="addToCartForm">
            <div class="form-group">
                <label>Quantity:</label>
                <input type="number" name="quantity" value="1" min="1"
                       max="{{ product.stock_quantity }}" style="width: 100px;">
            </div>
            {% if current_user.is_authenticated %}
            <button type="submit" class="btn btn-success" style="font-size: 1.2rem;">

                üõí Add to Cart
            </button>
            {% else %}
            <a class="btn" href="{{ url_for('auth.login') }}">üõí Let`s add to Cart</a>

            {% endif %}
        </form>


        {% else %}
        <p style="color: #e74c3c; font-size: 1.2rem;">Out of Stock</p>
        {% endif %}
    </div>
</div>

<div style="margin-top: 3rem;">
    <a href="/products/" class="btn">‚Üê Back to Products</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('addToCartForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const quantity = e.target.quantity.value;

        const response = await fetch('/cart/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                product_id: {{ product.id }},
                quantity: parseInt(quantity)
            })
        });

        const data = await response.json();

        if (response.ok) {
            alert('Added to cart!');
            window.location.href = '/cart';
        } else {
            alert('Error: ' + data.error);
        }
    });
</script>
{% endblock %}