{% extends "base.html" %}

{% block title %}Payment{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 3rem auto;">
    <h1>Payment ðŸ’³</h1>

    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 2rem 0;">
        <h3>Order #{{ order_id }}</h3>
        <p style="font-size: 1.5rem; color: #27ae60; margin-top: 1rem;">
            Total: ${{ total_amount }}
        </p>
    </div>

    <form id="payment-form">
        <div id="payment-element" style="margin: 2rem 0;">
            <!-- Stripe Payment Element will be inserted here -->
        </div>

        <button id="submit-button" class="btn btn-success" style="width: 100%; font-size: 1.2rem;">
            Pay Now
        </button>

        <div id="payment-message" style="margin-top: 1rem; display: none;"></div>
    </form>

    <p style="text-align: center; margin-top: 2rem; color: #999;">
        ðŸ”’ Secure payment powered by Stripe
    </p>
</div>
{% endblock %}

{% block scripts %}
<script src="https://js.stripe.com/v3/"></script>
<script>
const stripe = Stripe('{{ stripe_public_key }}');

const options = {
    clientSecret: '{{ client_secret }}',
    appearance: {
        theme: 'stripe'
    }
};

const elements = stripe.elements(options);
const paymentElement = elements.create('payment');
paymentElement.mount('#payment-element');

// Handle form submission
const form = document.getElementById('payment-form');
const submitButton = document.getElementById('submit-button');
const messageDiv = document.getElementById('payment-message');

form.addEventListener('submit', async (e) => {
    e.preventDefault();

    submitButton.disabled = true;
    submitButton.textContent = 'Processing...';

    const { error } = await stripe.confirmPayment({
        elements,
        confirmParams: {
            return_url: window.location.origin + '/payment/success?order_id={{ order_id }}'
        }
    });

    if (error) {
        messageDiv.textContent = error.message;
        messageDiv.style.display = 'block';
        messageDiv.style.color = '#e74c3c';
        submitButton.disabled = false;
        submitButton.textContent = 'Pay Now';
    }
});
</script>
{% endblock %}