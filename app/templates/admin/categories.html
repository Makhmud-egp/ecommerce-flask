{% extends "base.html" %}

{% block title %}Manage Categories{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h1>Manage Categories ðŸ“‚</h1>
    <button onclick="showAddCategoryModal()" class="btn btn-success">+ Add Category</button>
</div>

<div id="categoriesList" style="margin-top: 2rem;">
    <!-- Categories will load here -->
</div>

<!-- Modal -->
<div id="categoryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="background: white; max-width: 500px; margin: 5rem auto; padding: 2rem; border-radius: 8px;">
        <h2>Add Category</h2>
        
        <form id="categoryForm" style="margin-top: 2rem;">
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="categoryName" required>
            </div>
            
            <div class="form-group">
                <label>Description:</label>
                <textarea id="categoryDescription" rows="3"></textarea>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button type="submit" class="btn btn-primary">Save</button>
                <button type="button" onclick="closeCategoryModal()" class="btn">Cancel</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadCategories() {
    const response = await fetch('/categories/');
    const categories = await response.json();
    
    const list = document.getElementById('categoriesList');
    list.innerHTML = categories.map(c => `
        <div style="border: 1px solid #ddd; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
            <h3>${c.name}</h3>
            <p style="color: #666;">${c.description}</p>
            <p style="color: #999;">Products: ${c.product_count}</p>
        </div>
    `).join('');
}

function showAddCategoryModal() {
    document.getElementById('categoryModal').style.display = 'block';
}

function closeCategoryModal() {
    document.getElementById('categoryModal').style.display = 'none';
    document.getElementById('categoryForm').reset();
}

document.getElementById('categoryForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const data = {
        name: document.getElementById('categoryName').value,
        description: document.getElementById('categoryDescription').value
    };
    
    await fetch('/categories/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    
    closeCategoryModal();
    loadCategories();
});

loadCategories();
</script>
{% endblock %}